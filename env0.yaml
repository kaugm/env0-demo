version: 2

deploy:
    onSuccess:
      - name: Puppet
        run: |
          sudo yum update -y
          sudo rpm -Uvh https://yum.puppet.com/puppet7-release-el-7.noarch.rpm
          sudo yum install -y puppet-agent
          echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bashrc
          source ~/.bashrc
          sudo /opt/puppetlabs/bin/puppet resource service puppet ensure=running enable=true
          echo -e "package { 'nginx':\n  ensure => installed,\n}\n\nservice { 'nginx':\n  ensure => running,\n  enable => true,\n}" > nginx.pp
          puppet apply nginx.pp
